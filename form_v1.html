<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>QCM</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
</head>
<body>
<div id="root"></div>
<!-- compilation JSX => JS -->
<script type="text/babel">

    const container = document.getElementById('root')

    const questions = {
        'symfony' : {
            title : "Symfony design pattern",
            choices : ['MMV', 'MVC', 'MMVV'],
            response : 1,
            type : "select",
            name : "symfony",
            feedback : 'Symfony est basé sur le pattern MVC'
        },
        'react' : {
            title : "React est-il un framework ?",
            choices : ['yes', 'no'],
            response : 1,
            type : "radio",
            name : "react",
            feedback : "React est une librairie"
        },
        'jsx' : {
            title : "JSX c'est quoi ?",
            choices : ['JSX est un langage compilé', 'JSX est un sur-ensemble développé par Facebook'],
            response : 1,
            type: "radio" ,
            name : "jsx",
            feedback : 'JSX est un sur ensemble à JS'
        }
    }

    class Select extends React.Component{
        constructor(props) {
            super(props);
        }

        handleChange=(event)=>{
            if(event.target.value === this.props.question.response){
                this.state.score = this.state.score + 1
            }
        }

        render() {
            let content = <div>
                            <h2>{this.props.question.title}</h2>

                            <select className="form-control" name={this.props.question.name} onChange={this.handleChange}>
                                {
                                    this.props.question.choices.map((choice,index)=>{
                                            return (<option key={index} value={index}>{choice}</option>)
                                        }
                                    )
                                }
                            </select>
                            {this.props.done && <div className="feedback mt-2 alert-success">{this.props.question.feedback}</div>}
                        </div>;
            return (content);
        }
    }

    class Radio extends React.Component {
        constructor(props) {
            super(props)
        }

        handleChange=(event)=>{
            if(event.target.value === this.props.question.response){
                this.state.score = this.state.score + 1
            }
        }

        render(){
            let content = <div>
                <h2>{this.props.question.title}</h2>
                {
                    this.props.question.choices.map((choice, i) => {
                        return (
                            <div key={i} className="form-check form-check-inline">
                                <input name={this.props.question.name} className="form-check-input" id={this.props.question.name+i} type="radio" value={i} onChange={this.handleChange}/>
                                <label name={this.props.question.name} className="form-check-label" htmlFor={this.props.question.name+i}>{choice}</label>
                            </div>
                        );
                    })
                }
                {this.props.done && <div className="feedback mt-2 alert-success">{this.props.question.feedback}</div>}
            </div>
            return (content);
        }
    }

    class Input extends React.Component {
        constructor(props) {
            super(props)
            this.state = {
                value: ''
            };
        }

        handleChange = (event) => {
            this.setState({ value: event.target.value });
        }

        render(){
            return(<input id={this.props.id} className="form-control" value={this.state.value} name={this.props.name} type={this.props.type} onChange={this.handleChange} />)
        }
    }

    class Question extends React.Component {
        constructor(props) {
            super(props)
            this.question = this.props.question
        }

        render() {

            let type = this.question.type;

            switch (type) {
                case 'radio':
                    return (
                        <div>
                            <Radio question={this.question} done={this.props.done} />
                        </div>
                        )
                    break;
                case 'select':
                    return (
                        <div>
                            <Select question={this.question} done={this.props.done} />
                        </div>)
                    break;
                case 'input':
                    return (
                        <div>
                            <Input question={this.question} done={this.props.done} />
                        </div>)
                    break;
                default:
                    return(<div></div>)
            }
        }
    }

    class Wrapper extends React.Component {
        constructor(props) {
            super(props)
        }

        render(){
            return(<div className={"wrapper "+this.props.className}>
                {this.props.children}
            </div>)
        }
    }

    class App extends React.Component {
        constructor(props){
            super(props)
            this.state = {
                done: false,
                score: 0
            }
            this.questions = Object.entries(questions)
        }


        handleSubmit = (event) => {
            event.preventDefault();
            this.setState({
                done: true
            })
        }

        render() {
            return(
                <Wrapper className="container">
                    <div className="mt-5">
                        <p>Voici un QCM sur React répondez aux questions ci-dessous, pensez à laisser votre email, champ obligatoire (*) :</p>
                    </div>
                    <form>
                        <Wrapper className="header m-5">
                            <h1>QCM React</h1>
                            <div className="form-inline">
                                <div className="form-group">
                                    <label htmlFor="email-field">votre email (*) :</label>
                                    <Input id={"email-field"} name={"email"} type="email" />
                                </div>
                            </div>
                        </Wrapper>
                        <Wrapper className="questions">
                            <ol>
                                {
                                    this.questions.map((q,i)=> {
                                        let question = q[1];
                                        return(
                                            <li className="question mb-5" key={i}>
                                                <Wrapper className="question-body">
                                                    <Question question={question} done={this.state.done} />
                                                </Wrapper>
                                            </li>
                                        )
                                    })
                                }
                            </ol>
                        </Wrapper>
                        <div className="form-group">
                            <button className="btn btn-primary" onClick={this.handleSubmit}>Submit</button>
                        </div>

                        {this.state.done && <div>Score : {this.state.score}/{this.questions.length}</div>}
                    </form>
                </Wrapper> )
        }
    }


    ReactDOM.render(
        <App />,
        container
    );
</script>
</body>
</html>
